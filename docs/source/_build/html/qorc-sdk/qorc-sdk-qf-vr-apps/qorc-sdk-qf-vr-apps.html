

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>QORC Voice Recognition apps &mdash; QORC-SDK  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="1-Mic Voice recognition keyword detection example application" href="qorc-sdk-qf-vr-apps-qf-1micvr-app.html" />
    <link rel="prev" title="Quickfeather AI Application Project" href="../qorc-sdk-qf-apps/qorc-sdk-qf-apps-qf-mqttsn-ai-app.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/qorc_whitebg.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../qorc-setup/qorc-setup.html">Setup</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../qorc-sdk.html">QORC-SDK</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../qorc-sdk-hal/qorc-sdk-hal.html">QORC-SDK HAL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qorc-sdk-libraries/qorc-sdk-libraries.html">QORC-SDK Libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qorc-sdk-s3-gateware/qorc-sdk-s3-gateware.html">QORC-SDK EOS S3 FPGA Designs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qorc-sdk-qf-apps/qorc-sdk-qf-apps.html">QuickFeather Applications</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">QORC Voice Recognition apps</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="#key-concepts">Key concepts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#datablock-manager">Datablock manager</a></li>
<li class="toctree-l4"><a class="reference internal" href="#datablock-processor">Datablock processor</a></li>
<li class="toctree-l4"><a class="reference internal" href="#host-interface-task">Host Interface Task</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#vr-example-apps">VR Example Apps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#qf-1micvr-app-standalone-app-using-a-single-microphone">qf_1micVR_app: standalone app using a single microphone</a></li>
<li class="toctree-l4"><a class="reference internal" href="#qf-2micvr-app-standalone-app-using-two-microphones-with-stub-for-beamforming">qf_2micVR_app: standalone app using two microphones with stub for beamforming</a></li>
<li class="toctree-l4"><a class="reference internal" href="#qf-vr-raw-app-companion-app-implementing-vr-host-communications-over-spi-packetizing-raw-audio-with-and-streaming-the-audio-packets-over-spi-r">qf_VR_raw_app: companion app implementing VR, host communications over SPI, packetizing raw audio with and streaming the audio packets over SPI.r</a></li>
<li class="toctree-l4"><a class="reference internal" href="#qf-vr-opus-app-coming-soon-companion-app-implementing-vr-host-communications-over-spi-compressing-and-packetizing-audio-with-opus-and-streaming-the-audio-packets-over-spi">qf_VR_opus_app: [coming soon] companion app implementing VR, host communications over SPI, compressing and packetizing audio with opus and streaming the audio packets over SPI.</a></li>
<li class="toctree-l4"><a class="reference internal" href="#qf-vr-i2s-app-coming-soon-companion-app-implementing-vr-host-communications-over-spi-and-streaming-audio-over-i2s">qf_VR_I2S_app: [coming soon] companion app implementing VR, host communications over SPI and streaming audio over I2S</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../qorc-sdk-qorc-test-apps/qorc-sdk-qorc-test-apps.html">QORC Test Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../qorc-example-apps/qorc-example-apps.html">QORC Example Applications</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../ql-symbiflow/ql-symbiflow.html">QuickLogic FPGA Toolchain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ql-development-boards/ql-development-boards.html">QuickLogic Development Boards</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ql-eos-s3/ql-eos-s3.html">QuickLogic EOS S3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ql-faq/ql-faq.html">FAQ</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">QORC-SDK</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../qorc-sdk.html">QORC-SDK</a> &raquo;</li>
        
      <li>QORC Voice Recognition apps</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/qorc-sdk/qorc-sdk-qf-vr-apps/qorc-sdk-qf-vr-apps.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="qorc-voice-recognition-apps">
<h1>QORC Voice Recognition apps<a class="headerlink" href="#qorc-voice-recognition-apps" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>This is a series of 5 example apps located in the qf_vr_apps directory.
Unfortunately, the major VR engines are covered by proprietary licenses,
so these app have stubs where proprietary code needs to be installed.
Each of the apps demonstrates a different building block. For many
applications the apps may be usable as is, and for a few the developer
will need to combine elements from different apps.</p>
</div>
<div class="section" id="key-concepts">
<h2>Key concepts<a class="headerlink" href="#key-concepts" title="Permalink to this headline">¶</a></h2>
<div class="section" id="datablock-manager">
<h3>Datablock manager<a class="headerlink" href="#datablock-manager" title="Permalink to this headline">¶</a></h3>
<p>The qorc-sdk uses a datablock manager
(qorc-sdk/Libraries/DatablockManager) to handle high-speed real-time
data. During start-up the system allocates a pool of datablocks. During
audio processing the audio ISR obtains a block from the queue of free
blocks, fills it with data, and adds it to the processing queue. The
processing queue acts as an elastic buffer that can fill up when the
processer is heavily loaded, and drain when the processor is lightly
loaded, which allows variable rate handling of the audio data even
thought the input comes at a constant rate.</p>
<p>Datablocks can be assigned to more than one queue, and will only be
returned to the free queue when they are not allocated to any queue. An
example of assigning a datablock to more than one queue is when data is
streamed to a processing element, such as VR, and a storgae element such
as SD card.</p>
</div>
<div class="section" id="datablock-processor">
<h3>Datablock processor<a class="headerlink" href="#datablock-processor" title="Permalink to this headline">¶</a></h3>
<p>A typical audio processing system has a number of processing elements
arranged in a pipeline where the output of one element feeds the input
of the next element. The qorc-sdk has a mechanism called the datablock
processor (qorc-sdk/Tasks/DatablockProcessor) designed to manage
pipelines of fucntions that use datablocks. Each pipeline is implemented
as a task. Each function is called a processing element, and the entire
pipeline is specified by an array that defines a list of processing
elements and which datablock queues they read data from and which
datablock queues they write data to. <em>CRITICAL</em>: all processing elements
must be non-blocking.</p>
</div>
<div class="section" id="host-interface-task">
<h3>Host Interface Task<a class="headerlink" href="#host-interface-task" title="Permalink to this headline">¶</a></h3>
<p>Frequently the VR app needs to communicate with a BLE or WIFI device.
This interaction is managed by the Host Interface Task and usually
involves control packets that are communicated over a SPI link, and data
that is either compressed, packetized and transmitted over the SPI link,
or streamed isochronously over I2S.</p>
</div>
</div>
<div class="section" id="vr-example-apps">
<h2>VR Example Apps<a class="headerlink" href="#vr-example-apps" title="Permalink to this headline">¶</a></h2>
<div class="section" id="qf-1micvr-app-standalone-app-using-a-single-microphone">
<h3>qf_1micVR_app: standalone app using a single microphone<a class="headerlink" href="#qf-1micvr-app-standalone-app-using-a-single-microphone" title="Permalink to this headline">¶</a></h3>
<p><img alt="qf_1micVR_app" src="../../_images/qf_1micVR_app.png" /></p>
<div class="section" id="purpose">
<h4>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h4>
<p>Demonstrate the basic operation of the audio system and datablock
processor</p>
</div>
<div class="section" id="description">
<h4>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h4>
<p>This is the most basic VR app. The audio pipeline is very simple:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">datablk_pe_descriptor_t</span>  <span class="n">datablk_pe_descr_audio</span><span class="p">[]</span> <span class="o">=</span>
<span class="p">{</span>
<span class="o">/*</span> <span class="n">processing</span> <span class="n">element</span> <span class="n">descriptor</span> <span class="k">for</span> <span class="n">pre</span><span class="o">-</span><span class="n">processing</span> <span class="o">*/</span>
<span class="o">/*</span>            <span class="n">in_id</span>             <span class="n">out_id</span>                  <span class="n">fActive</span>  <span class="n">fSupplyOut</span> <span class="n">fReleaseIn</span>   <span class="n">poutq_processor</span>                    <span class="n">pe_funcs</span>          <span class="n">pe_bypass_func</span>   <span class="n">p_pe_sem</span>  <span class="o">*/</span>
<span class="o">/*</span> <span class="n">VR</span>   <span class="o">*/</span>  <span class="p">{</span> <span class="n">AUDIO_ISR_PID</span><span class="p">,</span>    <span class="n">AUDIO_QL_VR_PID</span><span class="p">,</span>            <span class="n">true</span><span class="p">,</span> <span class="n">false</span><span class="p">,</span> <span class="n">true</span><span class="p">,</span>      <span class="o">&amp;</span><span class="n">audio_ql_vr_outq_processor</span><span class="p">,</span>            <span class="o">&amp;</span><span class="n">ql_vr_funcs</span><span class="p">,</span>           <span class="n">NULL</span><span class="p">,</span>      <span class="o">&amp;</span><span class="n">ql_vr_sem</span> <span class="p">},</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The pipeline has one function for VR. It reads datablocks that have
PID=AUDIO_ISR_PID (the out_id is meaningless for the VR function). It is
<em>active</em>, meaning it will be called whenever a relevant datablock is
present, it does not need an empty datablock to use for output data, and
when processing is finished the datablock can be released (returned to
the free queue if it isn’t on another queue). The output queue processor
is not relevant since VR does not produce output data. The routines to
be called are defined by the ql_vr_funcs structure (more on this later).
There is not bypass function, and the semaphore used to stop processing
while changing parameters is ql_vr_sem.</p>
<p>There are two functions used by the VR processing :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span> <span class="n">ql</span> <span class="n">vr</span> <span class="n">processing</span> <span class="n">element</span> <span class="n">functions</span> <span class="o">*/</span>
<span class="n">datablk_pe_funcs_t</span> <span class="n">ql_vr_funcs</span> <span class="o">=</span> <span class="p">{</span><span class="n">datablk_pe_config_ql_vr</span><span class="p">,</span> <span class="n">datablk_pe_process_ql_vr</span><span class="p">,</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">NULL</span> <span class="p">}</span> <span class="p">;</span>
</pre></div>
</div>
<p>one to configure and one to process datablocks.</p>
</div>
<div class="section" id="required-hardware">
<h4>Required hardware<a class="headerlink" href="#required-hardware" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>QuickFeather</p></li>
</ul>
</div>
</div>
<div class="section" id="qf-2micvr-app-standalone-app-using-two-microphones-with-stub-for-beamforming">
<h3>qf_2micVR_app: standalone app using two microphones with stub for beamforming<a class="headerlink" href="#qf-2micvr-app-standalone-app-using-two-microphones-with-stub-for-beamforming" title="Permalink to this headline">¶</a></h3>
<p><img alt="qf_2micVR_app" src="../../_images/qf_2micVR_app.png" /></p>
<div class="section" id="purpose-1">
<span id="id1"></span><h4>Purpose<a class="headerlink" href="#purpose-1" title="Permalink to this headline">¶</a></h4>
<p>Demonstrate how to setup and handle stereo input.</p>
</div>
<div class="section" id="description-1">
<span id="id2"></span><h4>Description<a class="headerlink" href="#description-1" title="Permalink to this headline">¶</a></h4>
<p><em>Coming soon</em></p>
</div>
<div class="section" id="required-hardware-1">
<span id="id3"></span><h4>Required hardware<a class="headerlink" href="#required-hardware-1" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Modified QuickFeather (modifed to use external microphone)</p></li>
<li><p>Calaveras board (support 2 microphones)</p></li>
<li><p>Cradle (holds QuickFeather and Calaveras boards)</p>
<ul>
<li><p>QuickFeather AVS Cradle</p></li>
<li><p>Dual QuickFeather Cradle</p></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="qf-vr-raw-app-companion-app-implementing-vr-host-communications-over-spi-packetizing-raw-audio-with-and-streaming-the-audio-packets-over-spi-r">
<span id="qf-vr-raw-app-companion-app-implementing-vr-host-communications-over-spi-packetizing-raw-audio-with-and-streaming-the-audio-packets-over-spir"></span><h3>qf_VR_raw_app: companion app implementing VR, host communications over SPI, packetizing raw audio with and streaming the audio packets over SPI.r<a class="headerlink" href="#qf-vr-raw-app-companion-app-implementing-vr-host-communications-over-spi-packetizing-raw-audio-with-and-streaming-the-audio-packets-over-spi-r" title="Permalink to this headline">¶</a></h3>
<p><img alt="qf_VR_raw_app" src="../../_images/qf_VR_raw_app.png" /></p>
<div class="section" id="purpose-2">
<span id="id4"></span><h4>Purpose<a class="headerlink" href="#purpose-2" title="Permalink to this headline">¶</a></h4>
<p>Demonstrate host/companion command protocol and raw audio streaming over
SPI.</p>
</div>
<div class="section" id="description-2">
<span id="id5"></span><h4>Description<a class="headerlink" href="#description-2" title="Permalink to this headline">¶</a></h4>
<p><em>Coming soon</em></p>
</div>
<div class="section" id="required-hardware-2">
<span id="id6"></span><h4>Required hardware<a class="headerlink" href="#required-hardware-2" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>2xQuickFeather (one as companion, one as host)</p></li>
<li><p>I2S DAC board (audio output)</p></li>
<li><p>Cradle (holds QuickFeather companion and QuickFeather host)</p>
<ul>
<li><p><a class="reference external" href="https://github.com/QuickLogic-Corp/qf-cradle">Dual QuickFeather
Cradle</a></p></li>
</ul>
</li>
<li><p>PC to receive and analyze audio packets</p></li>
</ul>
</div>
</div>
<div class="section" id="qf-vr-opus-app-coming-soon-companion-app-implementing-vr-host-communications-over-spi-compressing-and-packetizing-audio-with-opus-and-streaming-the-audio-packets-over-spi">
<span id="id7"></span><h3>qf_VR_opus_app: [coming soon] companion app implementing VR, host communications over SPI, compressing and packetizing audio with opus and streaming the audio packets over SPI.<a class="headerlink" href="#qf-vr-opus-app-coming-soon-companion-app-implementing-vr-host-communications-over-spi-compressing-and-packetizing-audio-with-opus-and-streaming-the-audio-packets-over-spi" title="Permalink to this headline">¶</a></h3>
<p><img alt="qf_VR_opus_app" src="../../_images/qf_VR_opus_app.png" /></p>
<div class="section" id="purpose-3">
<span id="id8"></span><h4>Purpose<a class="headerlink" href="#purpose-3" title="Permalink to this headline">¶</a></h4>
<p>Demonstrate host/companion command protocol, opus compression and audio
streaming over SPI.</p>
</div>
<div class="section" id="description-3">
<span id="id9"></span><h4>Description<a class="headerlink" href="#description-3" title="Permalink to this headline">¶</a></h4>
<p><em>Coming soon</em></p>
</div>
<div class="section" id="required-hardware-3">
<span id="id10"></span><h4>Required hardware<a class="headerlink" href="#required-hardware-3" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>2xQuickFeather (one as companion, one as host)</p></li>
<li><p>I2S DAC board (audio output)</p></li>
<li><p>Cradle (holds QuickFeather companion and QuickFeather host)</p>
<ul>
<li><p>Dual QuickFeather Cradle</p></li>
</ul>
</li>
<li><p>PC to receive and decode opus packets</p></li>
</ul>
</div>
<div class="section" id="optional-local-playback">
<h4>Optional: Local playback<a class="headerlink" href="#optional-local-playback" title="Permalink to this headline">¶</a></h4>
<p>The hardware is configured to support real-time playback through DAC. No
plans for software support of this option. <img alt="qf_VR_opus_app_optional" src="../../_images/qf_VR_opus_app_optional.png" /></p>
</div>
</div>
<div class="section" id="qf-vr-i2s-app-coming-soon-companion-app-implementing-vr-host-communications-over-spi-and-streaming-audio-over-i2s">
<h3>qf_VR_I2S_app: [coming soon] companion app implementing VR, host communications over SPI and streaming audio over I2S<a class="headerlink" href="#qf-vr-i2s-app-coming-soon-companion-app-implementing-vr-host-communications-over-spi-and-streaming-audio-over-i2s" title="Permalink to this headline">¶</a></h3>
<p><img alt="qf_VR_I2S_app" src="../../_images/qf_VR_I2S_app.png" /></p>
<div class="section" id="purpose-4">
<span id="id11"></span><h4>Purpose<a class="headerlink" href="#purpose-4" title="Permalink to this headline">¶</a></h4>
<p>Demonstrate host/companion command protocol, and I2S isochronous output
that handles host/companion clock synchronization.</p>
</div>
<div class="section" id="description-4">
<span id="id12"></span><h4>Description<a class="headerlink" href="#description-4" title="Permalink to this headline">¶</a></h4>
<p><em>Coming soon</em></p>
</div>
<div class="section" id="required-hardware-4">
<span id="id13"></span><h4>Required hardware<a class="headerlink" href="#required-hardware-4" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>2xQuickFeather (one as companion, one as host)</p></li>
<li><p>I2S DAC board (audio output)</p></li>
<li><p>Cradle (holds QuickFeather companion and QuickFeather host)</p>
<ul>
<li><p>Dual QuickFeather Cradle</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="optional-pc-analysis">
<h4>Optional: PC analysis<a class="headerlink" href="#optional-pc-analysis" title="Permalink to this headline">¶</a></h4>
<p>The hardware is configured to support recording of I2S data on a PC. No
plans for software support of this option. <img alt="qf_VR_opus_I2S_optional" src="../../_images/qf_VR_I2S_app_optional.png" /></p>
<div class="toctree-wrapper compound">
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="qorc-sdk-qf-vr-apps-qf-1micvr-app.html" class="btn btn-neutral float-right" title="1-Mic Voice recognition keyword detection example application" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../qorc-sdk-qf-apps/qorc-sdk-qf-apps-qf-mqttsn-ai-app.html" class="btn btn-neutral float-left" title="Quickfeather AI Application Project" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, QuickLogic Corp

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>